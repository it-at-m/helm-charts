global:
 backend:
  name: backend
 frontend: 
  name: frontend


refarch-gateway:
  env:
    - name: SPRING_PROFILES_ACTIVE
      value: no-security
    - name: SSO_ISSUER_URL
      value: https://sso.muenchen.de/auth/realms/muenchen.de
    - name: SPRING_CLOUD_GATEWAY_ROUTES_0_ID
      value: backend
    - name: SPRING_CLOUD_GATEWAY_ROUTES_0_URI
      value: "http://{{ include \"backend.fullname\" . }}:8080/"
    - name: SPRING_CLOUD_GATEWAY_ROUTES_0_PREDICATES_0
      value: Path=/api/beispielprojekt-backend-service/**
    - name: SPRING_CLOUD_GATEWAY_ROUTES_0_FILTERS_0
      value: RewritePath=/api/beispielprojekt-backend-service/(?<urlsegments>.*), /$\{urlsegments}
    - name: SPRING_CLOUD_GATEWAY_ROUTES_0_FILTERS_1
      value: RemoveResponseHeader=WWW-Authenticate

    - name: SPRING_CLOUD_GATEWAY_ROUTES_1_ID
      value: frontend
    - name: SPRING_CLOUD_GATEWAY_ROUTES_1_URI
      value: "http://{{ include \"frontend.fullname\" . }}:8080/"
    - name: SPRING_CLOUD_GATEWAY_ROUTES_1_PREDICATES_0
      value: Path=/**
    - name: SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0
      value: RewritePath=/(?<urlsegments>.*), /$\{urlsegments}
    - name: SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_1
      value: RemoveResponseHeader=WWW-Authenticate

  ingress:
    enabled: true
    annotations:
      route.openshift.io/termination: "edge"
    className: openshift-default
    hosts:
      - host: sps-frontend-dev-spstest-test.apps.capk.muenchen.de
        paths:
          - path: /
            pathType: "ImplementationSpecific"
            backend:
              serviceName: '{{ include "refarch-gateway.fullname" . }}'
              servicePort: 8080

frontend:
  image:
    repository: ghcr.io/it-at-m/sps/sps-frontend
    tag: "latest"

backend:
  image:
    repository: ghcr.io/it-at-m/sps/sps-backend
    tag: "latest"
  env:
    - name: SPRING_PROFILES_ACTIVE
      value: no-security
