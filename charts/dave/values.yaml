# Default values for dave.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global values
global:
  fullnameOverride: "dave"
  serviceAccount:
    # Specifies whether a service account should be created
    create: true
    # Annotations to add to the service account
    annotations: {}
    # The name of the service account to use.
    # If not set and create is true, a name is generated using the fullname template
    name: ""
  extraEnvVars:
    # Spring session timout in seconds; Goal: same lifetime as SSO Session (e.g. 10 hours)
    - name: "SPRING_SESSION_TIMEOUT"
      value: "3600"

externalCharts:
  elasticsearch:
    # enable/disable elasticsearch chart dependency
    enabled: true
  postgresql:
    # enable/disable postgresql chart dependency
    enabled: true
  keycloak:
    # enable/disable keycloak chart dependency
    enabled: true

# Dave Backend
backend:
  replicaCount: 1
  fullnameOverride: dave-backend-service
  # Secret in OpenShift das über pipeline angelegt wird
  # Only use this if you already have a secret with:
    #   SPRING_DATASOURCE_PASSWORD
    #   DAVE_EMAIL_PASSWORD
    #   ELASTICSEARCH_PASSWORD
    #   ELASTICSEARCH_HTTPCACERTIFICATE
  existingSecret: dave-backend-secret
  # Environment Variables
  extraEnvVars:
    env:
      # DB
      # [By default such tables (and other objects) are automatically put into a schema named “public”. Every new database contains such a schema](https://www.postgresql.org/docs/current/ddl-schemas.html#DDL-SCHEMAS-PUBLIC).
      DB_SCHEMA: public
      SPRING_JPA_PROPERTIES_HIBERNATE_DEFAULT_SCHEMA: public
      SPRING_DATASOURCE_URL: jdbc:postgresql://dave-postgresql:5432/dave_db
      SPRING_DATASOURCE_USERNAME: dave
      SPRING_JPA_DATABASE: postgresql
      SPRING_JPA_HIBERNATE_DDLAUTO: validate
      SPRING_JPA_HIBERNATE_NAMING_PHYSICAL_STRATEGY: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
      SPRING_SECURITY_LOGGING_REQUESTS: all
      # flyway config for postgreSQL
      SPRING_FLYWAY_ENABLED: "true"
      SPRING_FLYWAY_SCHEMAS: public
      SPRING_FLYWAY_DEFAULTSCHEMA: public
      SPRING_FLYWAY_LOCATIONS: classpath:db/migration/
      SPRING_FLYWAY_VALIDATEMIGRATIONNAMING: "true"
      # hazelcast config
      HAZELCAST_GROUP_NAME: dave-backend-service-hazl_group
      HAZELCAST_INSTANCE: dave-backend-service-hazl_instance
      HAZELCAST_OPENSHIFTSERVICENAME: dave-backend-service
      HAZELCAST_OPENSHIFTNAMESPACE: dave-ng-demo
      SERVER_PORT: "8080"
      SPRING_PROFILES_ACTIVE: dev
      # fixes missing fonts bug
      ORG_APACHE_POI_SS_IGNOREMISSINGFONTSYSTEM: "true"
      # Elasticsearch
      ELASTICSEARCH_HOST: dave-elasticsearch
      ELASTICSEARCH_USER: elastic
      ELASTICSEARCH_PORT: "9200"
      ELASTICSEARCH_CONNECTTIMEOUT: "10"
      ELASTICSEARCH_SOCKETTIMEOUT: "30"
      ELASTICSEARCH_REINDEX: "true"
      ELASTICSEARCH_INDEX_SUFFIX: ""
      # dave requires HTTPS so you need to enable elasticsearch security
      # see https://github.com/it-at-m/helm-charts/issues/106
      ELASTICSEARCH_SECURITY_ENABLED: "true"
      ELASTICSEARCH_SECURITY_TLS_AUTOGENERATED: "true"
      ELASTICSEARCH_SCHEME: https
      # Dave
      # path to stadtbezirke.properties for custom stadtbezirke
      STADTBEZIRK_MAPPING_CONFIG_URL: classpath:/config/stadtbezirke.properties
      # cronjob for Messstelle. Default is disabled, to enable e. g. "0 0/5 * 1/1 * ?" -> every 5 min
      DAVE_MESSSTELLE_CRON: "-"
      # prevents the cronjob from running twice if you have multiple backends running
      DAVE_MESSSTELLE_SHEDLOCK: "4M"
      # cronjob for updating the zaehlung-status. "0 0/10 * 1/1 * ?" -> every 10 min
      DAVE_ZAEHLUNG_STATUSUPDATER_CRON: "0 0/10 * 1/1 * ?"
      # prevents the cronjob from running twice if you have multiple backends running
      DAVE_ZAEHLUNG_STATUSUPDATER_SHEDLOCK: "9M"
      # cronjob for updating unaufaelligetage-table. Default is disabled, to enable e. g. "0 0 4 1/1 * ?" -> Every day at 4:00 AM
      DAVE_UNAUFFAELLIGETAGE_CRON: "-"
      # prevents the cronjob from running twice if you have multiple backends running
      DAVE_UNAUFFAELLIGETAGE_SHEDLOCK: "1380M"
      # enables/disables automatic number generation for zaehlstellen. If disabled, you have to set the zaehlstellennummer manually for new zaehlstellen
      DAVE_ZAEHLSTELLE_AUTOMATICNUMBERASSIGNMENT: "true"
      # Sets the coordinates of every zaehlung in a 25 meter radius to the coordinates of the zaehlstelle
      DAVE_RADIUS_DISTANCE_CHECK_METER: "25"
      # Geodaten-EAI
      GEODATEN_EAI_URL: "http://dave-geo-eai-service:8088"
      # Document-Storage
      DOCUMENT_STORAGE_URL: http://dave-document-storage-service:8080
      # path to KI-model
      DAVE_ONNX_MODEL_PATH: model/Rad_Modell_DAVE.onnx
      # map center
      # Eichstätt
      DAVE_MAP_CENTER_LAT: "48.89529"
      DAVE_MAP_CENTER_LNG: "11.18026"
      DAVE_MAP_CENTER_ZOOM: "12"
      # Currently, only the maps of geoportal.muenchen.de are used, which cover the whole of Bavaria.
      # FR for other maps https://github.com/it-at-m/dave/issues/4
      # Dave Email Settings
      DAVE_EMAIL_URL_ADMINPORTAL: "http://localhost:8085"
      DAVE_EMAIL_URL_SELFSERVICEPORTAL: "http://localhost:8086"
      DAVE_EMAIL_RECEIVER_HOSTNAME: <Hostname>  # imap.url.de
      DAVE_EMAIL_SENDER_HOSTNAME: <Hostname>  # smtp.url.de
      DAVE_EMAIL_ADDRESS: <Email-Adress>
      DAVE_EMAIL_RECEIVER_CUTEMAILBODY_LINEBEGINSWITHSTRINGS: "Von:;Gesendet:"
      DAVE_EMAIL_RECEIVER_CUTEMAILBODY_LINECONTAINSSTRINGS: ""  # e.g., "Term1;Term2"
      DAVE_EMAIL_RECEIVER_CRON: "0 0/5 * 1/1 * ?"
      DAVE_EMAIL_RECEIVER_SHEDLOCK: "4M"
      DAVE_EMAIL_SENDER_URL_ADMINPORTAL: https://dave-adminportal
      DAVE_EMAIL_SENDER_URL_SELFSERVICEPORTAL: https://dave-selfserviceportal
      # Dave Reports Settings
      DAVE_REPORTS_LOGOICON: classpath:/pdf/images/kindl.jpg
      DAVE_REPORTS_LOGOSUBTITLE: "Landeshauptstadt<br/>München<br/><b>Mobilitätsreferat</b>"
    # Credentials
    credentials:
      SPRING_DATASOURCE_PASSWORD: dave_pwd
      DAVE_EMAIL_PASSWORD: <Email-Password>
      ELASTICSEARCH_PASSWORD: elasticsearch_pwd
      # CA cert fingerprint for elasticsearch security
      ELASTICSEARCH_HTTPCACERTIFICATE: <fingerprint>
  # Environment variables from other secrets/config maps
  extraEnvVarsSources: []
  extraVolumeMounts: []
  extraVolumes: []
# Dave Admin-Portal
admin-portal:
  replicaCount: 1
  fullnameOverride: dave-adminportal-apigateway-service

  # Environment variables
  extraEnvVars:
    # Hazelcast
    HAZELCAST_GROUP_NAME: dave-adminportal-apigateway-service-session_replication_group
    HAZELCAST_INSTANCE: dave-adminportal-apigateway-service-hazl_instance
    HAZELCAST_OPENSHIFT_SERVICE_NAME: dave-adminportal-apigateway-service

    SERVER_PORT: "8080"
    SPRING_PROFILES_ACTIVE: dev
    SPRING_CLOUD_GATEWAY_ACTUATOR_VERBOSE_ENABLED: "false"
    SPRING_CLOUD_GATEWAY_ROUTES_0_ID: sso
    SPRING_CLOUD_GATEWAY_ROUTES_0_URI: <SSO URI>
    SPRING_CLOUD_GATEWAY_ROUTES_0_PREDICATES_0: Path=/api/sso/userinfo
    SPRING_CLOUD_GATEWAY_ROUTES_0_FILTERS_0: RewritePath=/api/sso/userinfo, /auth/realms/<realm>/protocol/openid-connect/userinfo
    SPRING_CLOUD_GATEWAY_ROUTES_1_ID: backend
    SPRING_CLOUD_GATEWAY_ROUTES_1_URI: http://dave-backend-service:8080/
    SPRING_CLOUD_GATEWAY_ROUTES_1_PREDICATES_0: Path=/api/dave-backend-service/**
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_NAME: Retry
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_RETRIES: "2"
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_METHODS: GET
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_BACKOFF_FIRSTBACKOFF: 10ms
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_BACKOFF_MAXBACKOFF: 50ms
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_BACKOFF_FACTOR: "2"
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_BACKOFF_BASEDONPREVIOUSVALUE: "false"
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_1: RewritePath=/api/dave-backend-service/(?<urlsegments>.*), /$\{urlsegments}
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_2: RemoveResponseHeader=WWW-Authenticate
    SPRING_CLOUD_GATEWAY_DEFAULTFILTERS_0: RemoveResponseHeader=Expires
    SPRING_CLOUD_GATEWAY_DEFAULTFILTERS_1: RemoveRequestHeader=cookie
    SPRING_CLOUD_GATEWAY_DEFAULTFILTERS_2: RemoveRequestHeader=x-xsrf-token
    SPRING_CLOUD_GATEWAY_DEFAULTFILTERS_3: TokenRelay=

  extraVolumeMounts: []
  extraVolumes: []

# Dave EAI
eai:
  replicaCount: 1
  fullnameOverride: dave-eai-service

  # Environment variables
  extraEnvVars:
    BACKEND_URI: dave-backend-service:8080
    MANAGEMENT_SERVER_PORT: "8079"
    SERVER_PORT: "8080"
    SPRING_PROFILES_ACTIVE: dev

  extraVolumeMounts: []
  extraVolumes: []

# Dave Frontend
frontend:
  replicaCount: 1
  fullnameOverride: dave-frontend-apigateway-service

  # Environment variables
  extraEnvVars:
    # Hazelcast
    HAZELCAST_GROUP_NAME: dave-frontend-apigateway-service-session_replication_group
    HAZELCAST_INSTANCE: dave-frontend-apigateway-service-hazl_instance
    HAZELCAST_OPENSHIFT_SERVICE_NAME: dave-frontend-apigateway-service

    SERVER_PORT: "8080"
    SPRING_PROFILES_ACTIVE: dev
    SPRING_CLOUD_GATEWAY_ACTUATOR_VERBOSE_ENABLED: "false"
    SPRING_CLOUD_GATEWAY_ROUTES_0_ID: sso
    SPRING_CLOUD_GATEWAY_ROUTES_0_URI: <SSO URI>
    SPRING_CLOUD_GATEWAY_ROUTES_0_PREDICATES_0: Path=/api/sso/userinfo
    SPRING_CLOUD_GATEWAY_ROUTES_0_FILTERS_0: RewritePath=/api/sso/userinfo, /auth/realms/<realm>/protocol/openid-connect/userinfo
    SPRING_CLOUD_GATEWAY_ROUTES_1_ID: backend
    SPRING_CLOUD_GATEWAY_ROUTES_1_URI: http://dave-backend-service:8080/
    SPRING_CLOUD_GATEWAY_ROUTES_1_PREDICATES_0: Path=/api/dave-backend-service/**
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_NAME: Retry
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_RETRIES: "2"
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_METHODS: GET,POST
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_BACKOFF_FIRSTBACKOFF: 10ms
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_BACKOFF_MAXBACKOFF: 50ms
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_BACKOFF_FACTOR: "2"
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_BACKOFF_BASEDONPREVIOUSVALUE: "false"
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_1: RewritePath=/api/dave-backend-service/(?<urlsegments>.*), /$\{urlsegments}
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_2: RemoveResponseHeader=WWW-Authenticate
    SPRING_CLOUD_GATEWAY_ROUTES_2_ID: eai
    SPRING_CLOUD_GATEWAY_ROUTES_2_URI: http://dave-eai-service:8080/
    SPRING_CLOUD_GATEWAY_ROUTES_2_PREDICATES_0: Path=/api/dave-eai-service/**
    SPRING_CLOUD_GATEWAY_ROUTES_2_METADATA_RESPONSETIMEOUT: "1800000"
    SPRING_CLOUD_GATEWAY_ROUTES_2_FILTERS_0: RewritePath=/api/dave-eai-service/(?<urlsegments>.*), /$\{urlsegments}
    SPRING_CLOUD_GATEWAY_ROUTES_2_FILTERS_1: RemoveResponseHeader=WWW-Authenticate
    SPRING_CLOUD_GATEWAY_DEFAULTFILTERS_0: RemoveResponseHeader=Expires
    SPRING_CLOUD_GATEWAY_DEFAULTFILTERS_1: RemoveRequestHeader=cookie
    SPRING_CLOUD_GATEWAY_DEFAULTFILTERS_2: RemoveRequestHeader=x-xsrf-token
    SPRING_CLOUD_GATEWAY_DEFAULTFILTERS_3: TokenRelay=

  extraVolumeMounts: []
  extraVolumes: []

# Dave Selfservice-Portal
selfservice-portal:
  replicaCount: 1
  fullnameOverride: dave-selfserviceportal-apigateway-service

  extraEnvVars:
    # Hazelcast
    HAZELCAST_GROUP_NAME: dave-selfserviceportal-apigateway-service-session_replication_group
    HAZELCAST_INSTANCE: dave-selfserviceportal-apigateway-service-hazl_instance
    HAZELCAST_OPENSHIFT_SERVICE_NAME: dave-selfserviceportal-apigateway-service

    SERVER_PORT: "8080"
    SPRING_PROFILES_ACTIVE: dev
    SPRING_CLOUD_GATEWAY_ACTUATOR_VERBOSE_ENABLED: "false"
    SPRING_CLOUD_GATEWAY_ROUTES_0_ID: sso
    SPRING_CLOUD_GATEWAY_ROUTES_0_URI: <SSO URI>
    SPRING_CLOUD_GATEWAY_ROUTES_0_PREDICATES_0: Path=/api/sso/userinfo
    SPRING_CLOUD_GATEWAY_ROUTES_0_FILTERS_0: RewritePath=/api/sso/userinfo, /auth/realms/<realm>/protocol/openid-connect/userinfo
    SPRING_CLOUD_GATEWAY_ROUTES_1_ID: backend
    SPRING_CLOUD_GATEWAY_ROUTES_1_URI: http://dave-backend-service:8080/
    SPRING_CLOUD_GATEWAY_ROUTES_1_PREDICATES_0: Path=/api/dave-backend-service/**
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_NAME: Retry
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_RETRIES: "2"
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_METHODS: GET
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_BACKOFF_FIRSTBACKOFF: 10ms
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_BACKOFF_MAXBACKOFF: 50ms
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_BACKOFF_FACTOR: "2"
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_0_ARGS_BACKOFF_BASEDONPREVIOUSVALUE: "false"
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_1: RewritePath=/api/dave-backend-service/(?<urlsegments>.*), /$\{urlsegments}
    SPRING_CLOUD_GATEWAY_ROUTES_1_FILTERS_2: RemoveResponseHeader=WWW-Authenticate
    SPRING_CLOUD_GATEWAY_DEFAULTFILTERS_0: RemoveResponseHeader=Expires
    SPRING_CLOUD_GATEWAY_DEFAULTFILTERS_1: RemoveRequestHeader=cookie
    SPRING_CLOUD_GATEWAY_DEFAULTFILTERS_2: RemoveRequestHeader=x-xsrf-token
    SPRING_CLOUD_GATEWAY_DEFAULTFILTERS_3: TokenRelay=

  extraVolumeMounts: []
  extraVolumes: []

# Dave Document Storage
document-storage:
  replicaCount: 1
  fullnameOverride: dave-document-storage-service
  # Environment variables
  extraEnvVars:
    # Java
    JAVA_OPTS_APPEND: -Dfile.encoding=UTF-8
    # Other
    GC_MAX_METASPACE_SIZE: "256"
    MANAGEMENT_SERVER_PORT: "8079"
    SERVER_PORT: "8080"
    SPRING_PROFILES_ACTIVE: dev
    # Security
    REALM: Dave
    SPRING_SECURITY_LOGGING.REQUESTS: all
    SPRING_SECURITY_OAUTH2_RESOURCE_USER-INFO-URI: ${keycloak.auth-server-url}/realms/${realm}/protocol/openid-connect/userinfo
    SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER-URI: ${keycloak.auth-server-url}/realms/${realm}
    SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_JWK-SET-URI: ${keycloak.auth-server-url}/realms/${realm}/protocol/openid-connect/certs
    SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_KEYCLOAK_TOKEN_URI: ${keycloak.auth-server-url}/realms/${realm}/protocol/openid-connect/token
    SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KEYCLOAK_CLIENT-ID: dave
    SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KEYCLOAK_CLIENT-SECRET: <CLIENT-SECRET>
    SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KEYCLOAK_AUTHORIZATION-GRANT-TYPE: client_credentials
    SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KEYCLOAK_CLIENT-AUTHENTICATION-METHOD: client_secret_post
    # S3
    REFARCH_S3_URL: <S3-URL>
    REFARCH_S3_BUCKETNAME: <BUCKET-NAME>
    REFARCH_S3_ACCESSKEY: <ACCESSKEY>
    REFARCH_S3_SECRETKEY: <SECRETKEY>
  # Volume for CA-Certfificates
  extraVolumeMounts: []
  extraVolumes: []

# Dave Geodata Eai
geodata-eai:
  replicaCount: 1
  fullnameOverride: dave-geodata-eai-service
  # Environment variables
  extraEnvVars:
    # Other
    GC_MAX_METASPACE_SIZE: "256"
    MANAGEMENT_SERVER_PORT: "8079"
    SERVER_PORT: "8080"
    SPRING_PROFILES_ACTIVE: dev
    # Security
    SPRING_SECURITY_LOGGING.REQUESTS: all
    SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUERURI: <URL-TO-ISSUER-URI>
    SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_JWKSETURI: <URL-TO-JWK-SET-URI>
    SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_SSOMOBIDAMMESSWERTE_TOKENURI: <URL-TO-MOBIDAM-TOKEN-URI>
    SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_SSOMOBIDAMMESSWERT_CLIENTID: <CLIENT-ID>
    SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_SSOMOBIDAMMESSWERT_CLIENTSECRET: <CLIENT-SECRET>
    SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_SSOMOBIDAMMESSWERT_AUTHORIZATIONGRANTTYPE: client_credentials
    SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_SSOMOBIDAMMESSWERT_CLIENTAUTHENTICATIONMETHOD: client_secret_post
    SPRING_CODEC_MAXINMEMORYSIZE: 52428800
    # API for data extraction
    MOBIDAM_MESSWERTE_EAI_URL: <URL-TO-EAI-FOR-MESSWERTE-EXTRACTION>
    FEATURE_SERVER_URL_MESSSTELLE: <URL-TO-ARCGIS-FEATURE-FOR-MESSSTELLE>
    FEATURE_SERVER_URL_MESSQUERSCHNITT: <URL-TO-ARCGIS-FEATURE-FOR-MESSQUERSCHNITT>
    FEATURE_SERVER_URL_MESSFAEHIGKEIT: <URL-TO-ARCGIS-FEATURE-FOR-MESSFAEHIGKEIT>
    FEATURE_SERVER_URL_MESSWERTETAGESAGGREGAT: <URL-TO-ARCGIS-FEATURE-FOR-MESSWERTE-TAGESAGGREGAT>
  # Volume for CA-Certfificates
  extraVolumeMounts: []
  extraVolumes: []

# Subcharts
# Elasticsearch
# https://github.com/bitnami/charts/tree/main/bitnami/elasticsearch
elasticsearch:
  clusterName: dave
  sysctlImage:
    enabled: false
  coordinating:
    replicaCount: 0
  data:
    replicaCount: 0
  ingest:
    replicaCount: 0
  master:
    heapSize: 512m
    masterOnly: false
    replicaCount: 1
    resources:
      limits:
        cpu: 2
        memory: 1Gi
      requests:
        cpu: 100m
        memory: 1Gi
    podSecurityContext:
      enabled: false
    containerSecurityContext:
      enabled: false

# PostgreSQL
# https://github.com/bitnami/charts/tree/main/bitnami/postgresql
postgresql:
  auth:
    username: dave
    password: dave_pwd
    database: dave_db
  primary:
    containerSecurityContext:
      enabled: false
    podSecurityContext:
      enabled: false

# Keycloak
# https://github.com/bitnami/charts/tree/bitnami/keycloak
keycloak:
  postgresql:
    nameOverride: keycloak-postgresql

  keycloakConfigCli:
    enabled: true
    initContainers: |
      - name: fetch-config
        image: {{ include "common.images.image" (dict "imageRoot" (dict "repository" "bitnami/os-shell" "tag" "latest") "global" .Values.global) }}
        command:
          - /bin/sh
          - -c
          - |
            curl -L https://github.com/it-at-m/dave-backend/raw/refs/heads/sprint/sso-config/sso-client.json |
              jq '{"clients": [.], "enabled": true, "realm": "Dave", "displayName": "DAVe"}' > /config/sso.json
        volumeMounts:
          - name: config-volume
            mountPath: /config
        securityContext: {{- include "common.compatibility.renderSecurityContext" (dict "secContext" .Values.keycloakConfigCli.containerSecurityContext "context" $) | nindent 4 }}
    extraVolumes:
      - name: config-volume
        emptyDir:
          sizeLimit: 10Mi
    extraVolumeMounts:
      - name: config-volume
        mountPath: /config
    extraEnvVars:
      - name: IMPORT_FILES_LOCATIONS
        value: /config/*
